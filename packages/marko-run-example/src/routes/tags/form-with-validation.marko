import { FormValidator } from "@vwong/marko-run-addons/client";
export type Input = Omit<Marko.Input<"form">, "content"> & {
  content: Marko.Body<[{ isError: boolean; isPending: boolean; }]>;
};

<let/isPending=false>
<let/isError=false>

<form/form
  ...input
  onSubmit() {
    isPending = true;
  }>
  <csrf-token/>
  <${input.content} isError=isError isPending=isPending/>
</form>

<script>
  new FormValidator({
    formEl: form(),
    onInputError(el: HTMLInputElement, message: string) {
      const errorElementId = el.getAttribute("aria-errormessage");
      if (errorElementId) {
        const errorElement = document.getElementById(errorElementId);
        errorElement!.innerText = message;
      }
    },
    onInvalid: () => {
      isPending = false;
      isError = true;
    },
    onPending: () => {
      isPending = true;
      isError = false;
    },
    onValid: () => {
      isPending = false;
      isError = false;
    },
  });
</script>
